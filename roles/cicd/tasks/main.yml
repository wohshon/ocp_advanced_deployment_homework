---
- name: Deploy Jenkins
  script: deploy-jenkins-persistent.sh

- name: Test URL
  shell: echo https://$(sudo oc get route | awk 'NR>1 {print $2}')  
  register: url

- name: debug 
  debug:
    msg: " Jenkins URL: {{ url.stdout }}"

- name: "wait for pod to come up"
  uri:
    url: "{{ url.stdout }}"
    status_code: 403
    validate_certs: no
  register: result
  until: result.status == 403
  retries: 120
  delay: 2 

- name: Jenkins Deployed
  debug:
    msg: "***JENKINS DEPLOYED***"
  when: result.status == 403

